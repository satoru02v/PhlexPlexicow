FROM caddy:2.4.6-alpine

ARG VUE_APP_G5V_API_URL
RUN touch .env.production
RUN echo $VUE_APP_G5V_API_URL < .env.production

# install prerequisits 
RUN apk update && apk add \
	nodejs \
	yarn	




# create folder and copy application into folder
RUN mkdir G5V
COPY ./ /G5V/
WORKDIR /G5V

# Copy over Caddyfile with replacements via sed.
CMD sh /G5V/G5V/setEnv.sh
COPY Caddyfile /etc/caddy/Caddyfile

# build application using yarn
RUN yarn && yarn build

# copy results to Caddy directory
RUN cp -R ./dist/* /usr/share/caddy/
